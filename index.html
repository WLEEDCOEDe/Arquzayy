<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù‡Ø§Ù… Ø§Ù„Ø§Ø±Ù‚ÙˆØ§Ø²ÙŠ V2    </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-20px);
            }
        }
        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 0.3;
            }
            50% {
                opacity: 1;
            }
        }
        .animate-bounce {
            animation: bounce 2s infinite;
        }
        .animate-spin {
            animation: spin 3s linear infinite;
        }
        .animate-pulse {
            animation: pulse 2s ease-in-out infinite;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .tab-btn {
            transition: all 0.3s ease;
        }
        .tab-btn.active {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-purple-100 to-pink-200 min-h-screen transition-colors duration-300">
    <!-- Stars -->
    <div style="position: fixed; top: 80px; left: 40px; font-size: 3rem; opacity: 0.3;" class="animate-pulse">â­</div>
    <div style="position: fixed; top: 240px; left: 80px; font-size: 2.5rem; opacity: 0.25; animation-delay: 0.5s;" class="animate-pulse">âœ¨</div>
    <div style="position: fixed; bottom: 160px; left: 64px; font-size: 2rem; opacity: 0.2; animation-delay: 1s;" class="animate-pulse">ğŸŒŸ</div>
    <div style="position: fixed; top: 128px; right: 40px; font-size: 3rem; opacity: 0.3; animation-delay: 0.3s;" class="animate-pulse">â­</div>
    <div style="position: fixed; bottom: 240px; right: 80px; font-size: 2.5rem; opacity: 0.25; animation-delay: 1.2s;" class="animate-pulse">âœ¨</div>
    <div style="position: fixed; top: 320px; right: 128px; font-size: 2rem; opacity: 0.2; animation-delay: 0.8s;" class="animate-pulse">ğŸŒŸ</div>
    <div style="position: fixed; bottom: 80px; right: 40px; font-size: 4rem; opacity: 0.2; animation-delay: 1s;" class="animate-bounce">ğŸ’–</div>
    <div style="position: fixed; top: 160px; left: 50%; font-size: 2.5rem; opacity: 0.2; animation-delay: 0.5s;" class="animate-bounce">ğŸŒ¸</div>
    <div id="confettiContainer"></div>

    <div class="max-w-6xl mx-auto p-4 sm:p-8">
        <div class="text-center mb-8 relative">
            <button id="darkModeBtn" class="absolute right-0 top-0 p-3 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:scale-110 transition-transform shadow-lg">
                â˜€ï¸
            </button>
            <div class="absolute left-0 top-0 bg-gradient-to-r from-purple-500 to-pink-500 text-white px-4 py-2 rounded-full text-sm font-bold shadow-lg">
                V2 âœ¨ Ù…Ø¹ Ø§Ù„ØªØ§Ø±ÙŠØ®
            </div>

            <!-- Hello Kitty -->
            <div class="mb-6 relative inline-block">
                <div style="position: absolute; top: -8px; right: -8px; font-size: 2.5rem;" class="animate-spin">âœ¨</div>
                <div style="position: absolute; top: -8px; left: -8px; font-size: 2.5rem; animation-direction: reverse;" class="animate-spin">â­</div>
                <div class="bg-white/40 backdrop-blur-sm rounded-full p-6 shadow-2xl border-4 border-pink-300" style="animation: bounce 2s infinite;">
                    <svg width="120" height="120" viewBox="0 0 120 120">
                        <ellipse cx="60" cy="65" rx="45" ry="42" fill="#FFFFFF"/>
                        <ellipse cx="30" cy="30" rx="18" ry="22" fill="#FFFFFF"/>
                        <ellipse cx="30" cy="32" rx="12" ry="15" fill="#FFB6C1"/>
                        <ellipse cx="90" cy="30" rx="18" ry="22" fill="#FFFFFF"/>
                        <ellipse cx="90" cy="32" rx="12" ry="15" fill="#FFB6C1"/>
                        <ellipse cx="85" cy="25" rx="15" ry="12" fill="#FF1493"/>
                        <ellipse cx="105" cy="25" rx="15" ry="12" fill="#FF1493"/>
                        <circle cx="95" cy="25" r="8" fill="#FF69B4"/>
                        <circle cx="95" cy="25" r="4" fill="#FFB6C1"/>
                        <ellipse cx="45" cy="60" rx="4" ry="8" fill="#000000"/>
                        <ellipse cx="75" cy="60" rx="4" ry="8" fill="#000000"/>
                        <ellipse cx="60" cy="70" rx="3" ry="4" fill="#FFD700"/>
                        <line x1="25" y1="68" x2="42" y2="68" stroke="#000000" stroke-width="1.5"/>
                        <line x1="25" y1="73" x2="42" y2="71" stroke="#000000" stroke-width="1.5"/>
                        <line x1="25" y1="78" x2="42" y2="75" stroke="#000000" stroke-width="1.5"/>
                        <line x1="78" y1="68" x2="95" y2="68" stroke="#000000" stroke-width="1.5"/>
                        <line x1="78" y1="71" x2="95" y2="73" stroke="#000000" stroke-width="1.5"/>
                        <line x1="78" y1="75" x2="95" y2="78" stroke="#000000" stroke-width="1.5"/>
                    </svg>
                </div>
                <div style="position: absolute; bottom: -8px; right: -8px; font-size: 2.5rem;" class="animate-pulse">ğŸ’–</div>
                <div style="position: absolute; bottom: -8px; left: -8px; font-size: 2.5rem; animation-delay: 0.5s;" class="animate-pulse">ğŸŒ¸</div>
            </div>

            <!-- Reward Message -->
            <div id="rewardMessage" style="display: none;" class="mb-6 animate-pulse">
                <div class="bg-gradient-to-r from-yellow-400 via-pink-500 to-purple-600 text-white rounded-3xl px-8 py-6 shadow-2xl inline-block" style="transform: scale(1.1);">
                    <div class="text-6xl mb-3">ğŸ‰ ğŸ† âœ¨</div>
                    <h2 class="text-3xl font-bold mb-2"> ÙƒÙÙˆ ÙŠØ§Ù…Ù„ÙƒØ§ Ø§Ù„Ù‚Ø±ÙˆØ¯ </h2>
                    <p class="text-lg opacity-90">ÙˆØ´ Ù…Ù‡Ø§Ù…Ùƒ Ù„Ø¨ÙƒØ±Ø©ØŸ ğŸ“</p>
                </div>
            </div>

            <div class="inline-block mb-4">
                <div class="bg-gradient-to-r from-pink-500 via-purple-500 to-pink-600 text-white rounded-3xl px-8 py-4 shadow-2xl hover:scale-105 transition-transform border-4 border-white/30">
                    <h1 class="text-4xl font-bold mb-2 flex items-center justify-center gap-3">
                        <span>ğŸ€</span> Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ© <span>ğŸ€</span>
                    </h1>
                    <div class="flex items-center justify-center gap-2 text-sm opacity-90">
                        <span>ğŸ“…</span>
                        <span id="currentDate"></span>
                    </div>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <div class="flex justify-center mb-8 overflow-x-auto">
                <div class="inline-flex rounded-2xl bg-white/80 backdrop-blur-sm p-1 shadow-lg">
                    <button id="todayTab" class="tab-btn active px-6 py-3 rounded-xl font-bold bg-gradient-to-r from-pink-500 to-purple-500 text-white">
                        Ø§Ù„ÙŠÙˆÙ… ğŸ“‹
                    </button>
                    <button id="calendarTab" class="tab-btn px-6 py-3 rounded-xl font-bold bg-gradient-to-r from-purple-400 to-blue-400 text-white mx-1">
                        Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ ğŸ—“ï¸
                    </button>
                    <button id="historyTab" class="tab-btn px-6 py-3 rounded-xl font-bold bg-gradient-to-r from-blue-500 to-green-500 text-white">
                        Ø³Ø¬Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² ğŸ“Š
                    </button>
                </div>
            </div>

            <!-- Progress Container (Today Page) -->
            <div id="progressContainer" class="bg-white/90 backdrop-blur-lg rounded-2xl p-6 shadow-xl border border-purple-200">
                <div class="flex justify-between mb-3">
                    <span class="text-gray-900 font-semibold">Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠ</span>
                    <span class="text-gray-600 font-bold" id="progressText">0 / 0</span>
                </div>
                <div class="w-full h-4 bg-gray-200 rounded-full overflow-hidden">
                    <div id="progressBar" class="h-full bg-gradient-to-r from-purple-500 via-pink-500 to-blue-500 transition-all duration-500 relative" style="width: 0%">
                        <div class="absolute inset-0 bg-white/30 animate-pulse"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Today Page -->
        <div id="todayPage" class="page active">
            <div id="inputContainer" class="bg-white/90 backdrop-blur-lg rounded-2xl p-6 mb-6 shadow-xl border border-purple-200">
                <div class="flex flex-col sm:flex-row gap-3">
                    <input type="text" id="taskInput" placeholder="Ø£Ø¶Ù Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©..." class="flex-1 px-5 py-4 rounded-xl border-2 bg-white border-purple-300 text-gray-900 focus:border-purple-500 focus:outline-none transition-all text-lg">
                    
                    <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto">
                        <select id="prioritySelect" class="px-4 py-4 rounded-xl border-2 bg-white border-purple-300 text-gray-900 focus:border-purple-500 focus:outline-none transition-all flex-1">
                            <option value="low">Ø£ÙˆÙ„ÙˆÙŠØ© Ù…Ù†Ø®ÙØ¶Ø©</option>
                            <option value="medium" selected>Ø£ÙˆÙ„ÙˆÙŠØ© Ù…ØªÙˆØ³Ø·Ø©</option>
                            <option value="high">Ø£ÙˆÙ„ÙˆÙŠØ© Ø¹Ø§Ù„ÙŠØ©</option>
                        </select>
                        
                        <select id="daySelect" class="px-4 py-4 rounded-xl border-2 bg-white border-purple-300 text-gray-900 focus:border-purple-500 focus:outline-none transition-all flex-1">
                            <option value="today">Ø§Ù„ÙŠÙˆÙ…</option>
                            <option value="tomorrow">ØºØ¯Ø§Ù‹</option>
                            <option value="day3">Ø¨Ø¹Ø¯ Ø¨ÙƒØ±Ù‡</option>
                            <option value="day4">Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø±Ø§Ø¨Ø¹</option>
                            <option value="day5">Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø®Ø§Ù…Ø³</option>
                        </select>
                        
                        <button id="addBtn" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-8 py-4 rounded-xl font-bold transition-all hover:scale-105 shadow-lg">
                            â• Ø¥Ø¶Ø§ÙØ©
                        </button>
                    </div>
                </div>
            </div>

            <div id="tasksList" class="space-y-3"></div>
        </div>

        <!-- Calendar Page -->
        <div id="calendarPage" class="page">
            <div class="bg-white/90 backdrop-blur-lg rounded-2xl p-6 mb-6 shadow-xl border border-purple-200">
                <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">ğŸ—“ï¸ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Day Cards will be inserted here -->
                </div>
                
                <div class="text-center text-gray-600">
                    <p class="mb-2">ğŸ“Œ ÙŠÙ…ÙƒÙ†Ùƒ Ø³Ø­Ø¨ Ø§Ù„Ù…Ù‡Ø§Ù… Ø¨ÙŠÙ† Ø§Ù„Ø£ÙŠØ§Ù… Ù„ØªØºÙŠÙŠØ± Ù…ÙˆØ¹Ø¯Ù‡Ø§</p>
                    <p class="text-sm">Ø§Ø³Ø­Ø¨ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„ØªØºÙŠÙŠØ± ØªØ§Ø±ÙŠØ®Ù‡Ø§</p>
                </div>
            </div>
            
            <div id="calendarTasks" class="space-y-6">
                <!-- Calendar tasks will be loaded here -->
            </div>
        </div>

        <!-- History Page -->
        <div id="historyPage" class="page">
            <div class="bg-white/90 backdrop-blur-lg rounded-2xl p-6 mb-6 shadow-xl border border-purple-200">
                <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">ğŸ“Š Ø³Ø¬Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²</h2>
                
                <div class="flex flex-wrap justify-center gap-4 mb-6">
                    <button id="showAllHistory" class="px-4 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold">Ø§Ù„ÙƒÙ„</button>
                    <button id="showWeekHistory" class="px-4 py-2 rounded-lg bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold">Ø¢Ø®Ø± Ø£Ø³Ø¨ÙˆØ¹</button>
                    <button id="showMonthHistory" class="px-4 py-2 rounded-lg bg-gradient-to-r from-green-500 to-blue-500 text-white font-bold">Ø¢Ø®Ø± Ø´Ù‡Ø±</button>
                </div>
                
                <div id="historyStats" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <!-- Stats will be inserted here -->
                </div>
                
                <div id="historyList" class="space-y-4">
                    <!-- History items will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let tasks = [];
        let darkMode = false;
        let currentPage = 'today';
        
        // DOM Elements
        const taskInput = document.getElementById('taskInput');
        const prioritySelect = document.getElementById('prioritySelect');
        const daySelect = document.getElementById('daySelect');
        const addBtn = document.getElementById('addBtn');
        const tasksList = document.getElementById('tasksList');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const progressContainer = document.getElementById('progressContainer');
        const inputContainer = document.getElementById('inputContainer');
        const rewardMessage = document.getElementById('rewardMessage');
        const currentDate = document.getElementById('currentDate');
        const darkModeBtn = document.getElementById('darkModeBtn');
        
        // Page elements
        const todayPage = document.getElementById('todayPage');
        const calendarPage = document.getElementById('calendarPage');
        const historyPage = document.getElementById('historyPage');
        
        // Tab buttons
        const todayTab = document.getElementById('todayTab');
        const calendarTab = document.getElementById('calendarTab');
        const historyTab = document.getElementById('historyTab');
        
        // History filter buttons
        const showAllHistory = document.getElementById('showAllHistory');
        const showWeekHistory = document.getElementById('showWeekHistory');
        const showMonthHistory = document.getElementById('showMonthHistory');
        
        // Initialize date
        currentDate.textContent = new Date().toLocaleDateString('ar-SA', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        
        // Helper function to format dates
        function formatDate(date) {
            return date.toLocaleDateString('ar-SA', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        // Helper function to get date string for a specific day
        function getDateForDay(dayOffset) {
            const date = new Date();
            date.setDate(date.getDate() + dayOffset);
            return formatDate(date);
        }
        
        // Helper function to get date key for storage
        function getDateKey(date) {
            return date.toISOString().split('T')[0]; // YYYY-MM-DD format
        }
        
        // Load tasks from localStorage
        function loadTasks() {
            const saved = localStorage.getItem('taskAppData');
            if (saved) {
                const data = JSON.parse(saved);
                tasks = data.tasks || [];
                darkMode = data.darkMode || false;
                applyDarkMode();
            }
        }
        
        // Save tasks to localStorage
        function saveTasks() {
            const data = {
                tasks: tasks,
                darkMode: darkMode,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('taskAppData', JSON.stringify(data));
        }
        
        // Apply dark mode
        function applyDarkMode() {
            if (darkMode) {
                document.body.className = 'bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 min-h-screen transition-colors duration-300';
                darkModeBtn.textContent = 'ğŸŒ™';
                progressContainer.className = 'bg-gray-800/90 backdrop-blur-lg rounded-2xl p-6 shadow-xl border border-purple-700';
                inputContainer.className = 'bg-gray-800/90 backdrop-blur-lg rounded-2xl p-6 mb-6 shadow-xl border border-purple-700';
                taskInput.className = 'flex-1 px-5 py-4 rounded-xl border-2 bg-gray-700 border-purple-500 text-white focus:border-purple-400 focus:outline-none transition-all text-lg';
                prioritySelect.className = 'px-4 py-4 rounded-xl border-2 bg-gray-700 border-purple-500 text-white focus:border-purple-400 focus:outline-none transition-all';
                daySelect.className = 'px-4 py-4 rounded-xl border-2 bg-gray-700 border-purple-500 text-white focus:border-purple-400 focus:outline-none transition-all';
                
                const progressLabels = progressContainer.querySelectorAll('span');
                if (progressLabels[0]) progressLabels[0].className = 'text-gray-200 font-semibold';
                if (progressLabels[1]) progressLabels[1].className = 'text-gray-400 font-bold';
            } else {
                document.body.className = 'bg-gradient-to-br from-pink-100 via-purple-100 to-pink-200 min-h-screen transition-colors duration-300';
                darkModeBtn.textContent = 'â˜€ï¸';
                progressContainer.className = 'bg-white/90 backdrop-blur-lg rounded-2xl p-6 shadow-xl border border-purple-200';
                inputContainer.className = 'bg-white/90 backdrop-blur-lg rounded-2xl p-6 mb-6 shadow-xl border border-purple-200';
                taskInput.className = 'flex-1 px-5 py-4 rounded-xl border-2 bg-white border-purple-300 text-gray-900 focus:border-purple-500 focus:outline-none transition-all text-lg';
                prioritySelect.className = 'px-4 py-4 rounded-xl border-2 bg-white border-purple-300 text-gray-900 focus:border-purple-500 focus:outline-none transition-all';
                daySelect.className = 'px-4 py-4 rounded-xl border-2 bg-white border-purple-300 text-gray-900 focus:border-purple-500 focus:outline-none transition-all';
                
                const progressLabels = progressContainer.querySelectorAll('span');
                if (progressLabels[0]) progressLabels[0].className = 'text-gray-900 font-semibold';
                if (progressLabels[1]) progressLabels[1].className = 'text-gray-600 font-bold';
            }
            
            // Update all task displays
            renderTodayTasks();
            renderCalendarTasks();
            renderHistory();
        }
        
        // Toggle dark mode
        function toggleDarkMode() {
            darkMode = !darkMode;
            saveTasks();
            applyDarkMode();
        }
        
        // Play meow sound
        function playMeow() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);
            } catch (e) {
                console.log('Audio not supported');
            }
        }
        
        // Show confetti
        function showConfetti() {
            const container = document.getElementById('confettiContainer');
            container.innerHTML = '';
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'fixed';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.top = '-20px';
                confetti.style.width = '12px';
                confetti.style.height = '12px';
                confetti.style.borderRadius = '50%';
                confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 70%, 60%)`;
                confetti.style.animation = `fall ${2 + Math.random() * 2}s ease-in ${Math.random() * 2}s forwards`;
                confetti.style.zIndex = '9999';
                container.appendChild(confetti);
            }
            
            setTimeout(() => container.innerHTML = '', 5000);
        }
        
        // Update progress bar
        function updateProgress() {
            const today = new Date().toISOString().split('T')[0];
            const todayTasks = tasks.filter(t => t.date === today || t.day === 'today');
            const completed = todayTasks.filter(t => t.completed).length;
            const total = todayTasks.length;
            const percent = total > 0 ? (completed / total) * 100 : 0;
            
            progressBar.style.width = percent + '%';
            progressText.textContent = `${completed} / ${total}`;
            
            if (total > 0 && completed === total) {
                rewardMessage.style.display = 'block';
                showConfetti();
                setTimeout(() => rewardMessage.style.display = 'none', 5000);
            }
        }
        
        // Get priority color
        function getPriorityColor(priority) {
            if (priority === 'high') return 'from-pink-400 to-pink-600';
            if (priority === 'medium') return 'from-purple-400 to-purple-600';
            return 'from-blue-400 to-blue-600';
        }
        
        // Get priority text
        function getPriorityText(priority) {
            if (priority === 'high') return 'Ø¹Ø§Ù„ÙŠ';
            if (priority === 'medium') return 'Ù…ØªÙˆØ³Ø·';
            return 'Ù…Ù†Ø®ÙØ¶';
        }
        
        // Get day name
        function getDayName(day) {
            const days = {
                'today': 'Ø§Ù„ÙŠÙˆÙ…',
                'tomorrow': 'ØºØ¯Ø§Ù‹',
                'day3': 'Ø¨Ø¹Ø¯ ØºØ¯',
                'day4': 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø±Ø§Ø¨Ø¹',
                'day5': 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø®Ø§Ù…Ø³'
            };
            return days[day] || day;
        }
        
        // Render today's tasks
        function renderTodayTasks() {
            const today = new Date().toISOString().split('T')[0];
            const todayTasks = tasks.filter(t => t.date === today || t.day === 'today');
            const bgClass = darkMode ? 'bg-gray-800/90' : 'bg-white/90';
            const textClass = darkMode ? 'text-gray-200' : 'text-gray-900';
            const borderClass = darkMode ? 'border-purple-700' : 'border-purple-200';
            const emptyTextClass = darkMode ? 'text-gray-400' : 'text-gray-600';
            
            if (todayTasks.length === 0) {
                tasksList.innerHTML = `
                    <div class="${bgClass} backdrop-blur-lg rounded-2xl p-12 text-center shadow-xl border ${borderClass}">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">â­</div>
                        <p class="${emptyTextClass} text-xl">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…. Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©!</p>
                    </div>
                `;
                updateProgress();
                return;
            }
            
            tasksList.innerHTML = todayTasks.map(task => `
                <div class="${bgClass} backdrop-blur-lg rounded-2xl p-5 shadow-lg border ${borderClass} hover:scale-[1.02] transition-all duration-200 task-item" data-id="${task.id}" draggable="true">
                    <div class="flex items-center gap-4">
                        <button onclick="toggleTask(${task.id})" class="flex-shrink-0 w-7 h-7 rounded-lg border-2 flex items-center justify-center transition-all ${task.completed ? 'bg-gradient-to-r from-green-500 to-emerald-500 border-green-500' : 'border-gray-300 hover:border-purple-500'}">
                            ${task.completed ? '<span style="color: white; font-size: 1.2rem;">âœ“</span>' : ''}
                        </button>
                        <div class="flex-shrink-0 w-2 h-2 rounded-full bg-gradient-to-r ${getPriorityColor(task.priority)}"></div>
                        <span class="flex-1 text-lg ${task.completed ? 'line-through opacity-50' : ''} ${textClass}">${task.text}</span>
                        <div class="flex items-center gap-2">
                            <span class="text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}">${getPriorityText(task.priority)}</span>
                            <button onclick="deleteTask(${task.id})" class="flex-shrink-0 p-2 rounded-lg bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white transition-all hover:scale-110">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            updateProgress();
        }
        
        // Render calendar tasks
        function renderCalendarTasks() {
            const calendarContainer = document.getElementById('calendarTasks');
            const bgClass = darkMode ? 'bg-gray-800/90' : 'bg-white/90';
            const textClass = darkMode ? 'text-gray-200' : 'text-gray-900';
            const borderClass = darkMode ? 'border-purple-700' : 'border-purple-200';
            
            // Create day cards
            const dayCardsContainer = calendarPage.querySelector('.grid');
            dayCardsContainer.innerHTML = '';
            
            const days = ['today', 'tomorrow', 'day3', 'day4', 'day5'];
            const dayColors = [
                'from-pink-500 to-purple-500',
                'from-purple-500 to-blue-500',
                'from-blue-500 to-green-500',
                'from-green-500 to-yellow-500',
                'from-yellow-500 to-pink-500'
            ];
            
            days.forEach((day, index) => {
                const dayTasks = tasks.filter(t => t.day === day);
                const completed = dayTasks.filter(t => t.completed).length;
                const total = dayTasks.length;
                
                const card = document.createElement('div');
                card.className = `${bgClass} backdrop-blur-lg rounded-2xl p-4 shadow-lg border ${borderClass}`;
                card.innerHTML = `
                    <div class="text-center mb-3">
                        <div class="text-xl font-bold ${textClass}">${getDayName(day)}</div>
                        <div class="text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}">${getDateForDay(index)}</div>
                    </div>
                    <div class="mb-3">
                        <div class="flex justify-between text-sm mb-1">
                            <span class="${textClass}">Ø§Ù„ØªÙ‚Ø¯Ù…</span>
                            <span class="${darkMode ? 'text-gray-400' : 'text-gray-600'}">${completed}/${total}</span>
                        </div>
                        <div class="w-full h-2 bg-gray-300 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r ${dayColors[index]}" style="width: ${total > 0 ? (completed/total)*100 : 0}%"></div>
                        </div>
                    </div>
                    <div class="text-center">
                        <span class="text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}">${total} Ù…Ù‡Ø§Ù…</span>
                    </div>
                `;
                dayCardsContainer.appendChild(card);
            });
            
            // Group tasks by day
            const tasksByDay = {};
            days.forEach(day => {
                tasksByDay[day] = tasks.filter(t => t.day === day);
            });
            
            // Render tasks by day
            calendarContainer.innerHTML = '';
            
            days.forEach((day, index) => {
                const dayTasks = tasksByDay[day];
                if (dayTasks.length === 0) return;
                
                const daySection = document.createElement('div');
                daySection.className = `${bgClass} backdrop-blur-lg rounded-2xl p-6 shadow-xl border ${borderClass}`;
                
                const dayTitle = document.createElement('h3');
                dayTitle.className = `text-xl font-bold mb-4 flex items-center gap-2 ${textClass}`;
                dayTitle.innerHTML = `<span>${getDayName(day)}</span> <span class="text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}">(${getDateForDay(index)})</span>`;
                
                const tasksList = document.createElement('div');
                tasksList.className = 'space-y-3';
                
                dayTasks.forEach(task => {
                    const taskElement = document.createElement('div');
                    taskElement.className = `p-4 rounded-xl border ${borderClass} ${task.completed ? 'opacity-70' : ''} task-item`; 
                    taskElement.setAttribute('data-id', task.id);
                    taskElement.setAttribute('draggable', 'true');
                    taskElement.setAttribute('data-day', day);
                    
                    taskElement.innerHTML = `
                        <div class="flex items-center gap-3">
                            <button onclick="toggleTask(${task.id})" class="flex-shrink-0 w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-all ${task.completed ? 'bg-gradient-to-r from-green-500 to-emerald-500 border-green-500' : 'border-gray-300 hover:border-purple-500'}">
                                ${task.completed ? '<span style="color: white; font-size: 1rem;">âœ“</span>' : ''}
                            </button>
                            <div class="flex-shrink-0 w-2 h-2 rounded-full bg-gradient-to-r ${getPriorityColor(task.priority)}"></div>
                            <span class="flex-1 ${task.completed ? 'line-through' : ''} ${textClass}">${task.text}</span>
                            <div class="flex items-center gap-2">
                                <span class="text-xs px-2 py-1 rounded-full ${darkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-100 text-gray-700'}">${getPriorityText(task.priority)}</span>
                                <button onclick="moveTaskToToday(${task.id})" class="text-sm px-3 py-1 rounded-lg ${darkMode ? 'bg-purple-700 text-white' : 'bg-purple-100 text-purple-700'} hover:opacity-80 transition-all">
                                    â¡ï¸ Ø§Ù„ÙŠÙˆÙ…
                                </button>
                                <button onclick="deleteTask(${task.id})" class="p-2 rounded-lg bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white transition-all hover:scale-110">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </div>
                    `;
                    tasksList.appendChild(taskElement);
                });
                
                daySection.appendChild(dayTitle);
                daySection.appendChild(tasksList);
                calendarContainer.appendChild(daySection);
            });
            
            // Add drag and drop functionality
            setupDragAndDrop();
        }
        
        // Render history
        function renderHistory(filter = 'all') {
            const historyList = document.getElementById('historyList');
            const historyStats = document.getElementById('historyStats');
            const bgClass = darkMode ? 'bg-gray-800/90' : 'bg-white/90';
            const textClass = darkMode ? 'text-gray-200' : 'text-gray-900';
            const borderClass = darkMode ? 'border-purple-700' : 'border-purple-200';
            
            // Get completed tasks
            const completedTasks = tasks.filter(t => t.completed);
            
            // Filter by date
            let filteredTasks = completedTasks;
            const now = new Date();
            
            if (filter === 'week') {
                const weekAgo = new Date(now);
                weekAgo.setDate(weekAgo.getDate() - 7);
                filteredTasks = completedTasks.filter(t => {
                    const completedDate = t.completedDate ? new Date(t.completedDate) : new Date();
                    return completedDate >= weekAgo;
                });
            } else if (filter === 'month') {
                const monthAgo = new Date(now);
                monthAgo.setMonth(monthAgo.getMonth() - 1);
                filteredTasks = completedTasks.filter(t => {
                    const completedDate = t.completedDate ? new Date(t.completedDate) : new Date();
                    return completedDate >= monthAgo;
                });
            }
            
            // Sort by completion date (newest first)
            filteredTasks.sort((a, b) => {
                const dateA = a.completedDate ? new Date(a.completedDate) : new Date(0);
                const dateB = b.completedDate ? new Date(b.completedDate) : new Date(0);
                return dateB - dateA;
            });
            
            // Render stats
            const totalCompleted = completedTasks.length;
            const weekCompleted = completedTasks.filter(t => {
                const completedDate = t.completedDate ? new Date(t.completedDate) : new Date();
                const weekAgo = new Date(now);
                weekAgo.setDate(weekAgo.getDate() - 7);
                return completedDate >= weekAgo;
            }).length;
            
            const monthCompleted = completedTasks.filter(t => {
                const completedDate = t.completedDate ? new Date(t.completedDate) : new Date();
                const monthAgo = new Date(now);
                monthAgo.setMonth(monthAgo.getMonth() - 1);
                return completedDate >= monthAgo;
            }).length;
            
            historyStats.innerHTML = `
                <div class="${bgClass} backdrop-blur-lg rounded-2xl p-4 shadow-lg border ${borderClass} text-center">
                    <div class="text-3xl font-bold ${textClass}">${totalCompleted}</div>
                    <div class="${darkMode ? 'text-gray-400' : 'text-gray-600'}">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ù†Ø¬Ø²Ø©</div>
                </div>
                <div class="${bgClass} backdrop-blur-lg rounded-2xl p-4 shadow-lg border ${borderClass} text-center">
                    <div class="text-3xl font-bold ${textClass}">${weekCompleted}</div>
                    <div class="${darkMode ? 'text-gray-400' : 'text-gray-600'}">Ù…ÙƒØªÙ…Ù„Ø© Ø®Ù„Ø§Ù„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div>
                </div>
                <div class="${bgClass} backdrop-blur-lg rounded-2xl p-4 shadow-lg border ${borderClass} text-center">
                    <div class="text-3xl font-bold ${textClass}">${monthCompleted}</div>
                    <div class="${darkMode ? 'text-gray-400' : 'text-gray-600'}">Ù…ÙƒØªÙ…Ù„Ø© Ø®Ù„Ø§Ù„ Ø§Ù„Ø´Ù‡Ø±</div>
                </div>
            `;
            
            // Render history list
            if (filteredTasks.length === 0) {
                historyList.innerHTML = `
                    <div class="${bgClass} backdrop-blur-lg rounded-2xl p-12 text-center shadow-xl border ${borderClass}">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸ“Š</div>
                        <p class="${darkMode ? 'text-gray-400' : 'text-gray-600'} text-xl">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ù…ÙƒØªÙ…Ù„Ø© Ø¨Ø¹Ø¯!</p>
                        <p class="${darkMode ? 'text-gray-500' : 'text-gray-500'} mt-2">Ø§ÙƒÙ…Ù„ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù‡Ø§Ù… Ù„ØªØ±Ø§Ù‡Ø§ Ù‡Ù†Ø§</p>
                    </div>
                `;
                return;
            }
            
            historyList.innerHTML = filteredTasks.map(task => {
                const completedDate = task.completedDate ? new Date(task.completedDate) : new Date();
                const dateStr = formatDate(completedDate);
                
                return `
                    <div class="${bgClass} backdrop-blur-lg rounded-2xl p-5 shadow-lg border ${borderClass}">
                        <div class="flex items-center gap-4">
                            <div class="flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-r from-green-400 to-emerald-600 flex items-center justify-center text-white text-xl">
                                âœ“
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-start">
                                    <span class="text-lg ${textClass}">${task.text}</span>
                                    <span class="text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}">${dateStr}</span>
                                </div>
                                <div class="flex gap-2 mt-2">
                                    <span class="text-xs px-2 py-1 rounded-full ${darkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-100 text-gray-700'}">
                                        ${getPriorityText(task.priority)}
                                    </span>
                                    <span class="text-xs px-2 py-1 rounded-full ${darkMode ? 'bg-purple-700 text-purple-300' : 'bg-purple-100 text-purple-700'}">
                                        ${getDayName(task.day)}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Add task
        function addTask() {
            const text = taskInput.value.trim();
            if (!text) return;
            
            const day = daySelect.value;
            const today = new Date().toISOString().split('T')[0];
            const date = day === 'today' ? today : getDateForFutureDay(day);
            
            tasks.push({
                id: Date.now(),
                text: text,
                completed: false,
                priority: prioritySelect.value,
                day: day,
                date: date,
                createdAt: new Date().toISOString()
            });
            
            taskInput.value = '';
            prioritySelect.value = 'medium';
            daySelect.value = 'today';
            
            saveTasks();
            renderTodayTasks();
            renderCalendarTasks();
        }
        
        // Helper to get future date
        function getDateForFutureDay(day) {
            const date = new Date();
            const dayOffsets = {
                'today': 0,
                'tomorrow': 1,
                'day3': 2,
                'day4': 3,
                'day5': 4
            };
            date.setDate(date.getDate() + (dayOffsets[day] || 0));
            return date.toISOString().split('T')[0];
        }
        
        // Toggle task completion
        function toggleTask(id) {
            const task = tasks.find(t => t.id === id);
            if (!task) return;
            
            // If completing the task, add completion date
            if (!task.completed) {
                task.completedDate = new Date().toISOString();
                playMeow();
            } else {
                task.completedDate = null;
            }
            
            task.completed = !task.completed;
            saveTasks();
            
            if (currentPage === 'today') {
                renderTodayTasks();
            } else if (currentPage === 'calendar') {
                renderCalendarTasks();
            }
            
            // Always update history if we're on that page
            if (currentPage === 'history') {
                renderHistory('all');
            }
        }
        
        // Delete task
        function deleteTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            saveTasks();
            
            if (currentPage === 'today') {
                renderTodayTasks();
            } else if (currentPage === 'calendar') {
                renderCalendarTasks();
            } else if (currentPage === 'history') {
                renderHistory('all');
            }
        }
        
        // Move task to today
        function moveTaskToToday(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.day = 'today';
                task.date = new Date().toISOString().split('T')[0];
                saveTasks();
                renderCalendarTasks();
                renderTodayTasks();
            }
        }
        
        // Setup drag and drop
        function setupDragAndDrop() {
            const taskItems = document.querySelectorAll('.task-item');
            
            taskItems.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', e.target.dataset.id);
                });
            });
            
            // Create drop zones for each day in calendar
            const daySections = document.querySelectorAll('#calendarPage > div > div');
            daySections.forEach(section => {
                section.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    section.style.opacity = '0.8';
                });
                
                section.addEventListener('dragleave', () => {
                    section.style.opacity = '1';
                });
                
                section.addEventListener('drop', (e) => {
                    e.preventDefault();
                    section.style.opacity = '1';
                    
                    const taskId = e.dataTransfer.getData('text/plain');
                    const dayHeader = section.querySelector('h3');
                    
                    if (dayHeader) {
                        const dayText = dayHeader.textContent;
                        const dayMap = {
                            'Ø§Ù„ÙŠÙˆÙ…': 'today',
                            'ØºØ¯Ø§Ù‹': 'tomorrow',
                            'Ø¨Ø¹Ø¯ ØºØ¯': 'day3',
                            'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø±Ø§Ø¨Ø¹': 'day4',
                            'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø®Ø§Ù…Ø³': 'day5'
                        };
                        
                        let targetDay = 'today';
                        for (const [key, value] of Object.entries(dayMap)) {
                            if (dayText.includes(key)) {
                                targetDay = value;
                                break;
                            }
                        }
                        
                        const task = tasks.find(t => t.id == taskId);
                        if (task) {
                            task.day = targetDay;
                            task.date = getDateForFutureDay(targetDay);
                            saveTasks();
                            renderCalendarTasks();
                            renderTodayTasks();
                        }
                    }
                });
            });
        }
        
        // Switch page
        function switchPage(page) {
            // Update current page
            currentPage = page;
            
            // Hide all pages
            todayPage.classList.remove('active');
            calendarPage.classList.remove('active');
            historyPage.classList.remove('active');
            
            // Remove active class from all tabs
            todayTab.classList.remove('active');
            calendarTab.classList.remove('active');
            historyTab.classList.remove('active');
            
            // Show selected page and activate tab
            if (page === 'today') {
                todayPage.classList.add('active');
                todayTab.classList.add('active');
            } else if (page === 'calendar') {
                calendarPage.classList.add('active');
                calendarTab.classList.add('active');
                renderCalendarTasks();
            } else if (page === 'history') {
                historyPage.classList.add('active');
                historyTab.classList.add('active');
                renderHistory('all');
            }
        }
        
        // Initialize
        loadTasks();
        
        // Event listeners
        addBtn.addEventListener('click', addTask);
        taskInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addTask();
        });
        
        darkModeBtn.addEventListener('click', toggleDarkMode);
        
        todayTab.addEventListener('click', () => switchPage('today'));
        calendarTab.addEventListener('click', () => switchPage('calendar'));
        historyTab.addEventListener('click', () => switchPage('history'));
        
        showAllHistory.addEventListener('click', () => renderHistory('all'));
        showWeekHistory.addEventListener('click', () => renderHistory('week'));
        showMonthHistory.addEventListener('click', () => renderHistory('month'));
        
        // Initial render
        renderTodayTasks();
        switchPage('today');
    </script>
</body>
</html>
